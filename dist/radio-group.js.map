{"version":3,"file":"radio-group.js","sources":["../src/index.tsx"],"sourcesContent":["import * as React from 'react';\n\nconst codes = {\n  RETURN: 13,\n  SPACE: 32,\n  END: 35,\n  HOME: 36,\n  LEFT: 37,\n  UP: 38,\n  RIGHT: 39,\n  DOWN: 40,\n};\n\nexport interface RadioGroupCtx<V, Siblings = V[]> {\n  value: V;\n  otherRadioValues: Siblings;\n  setChecked: (value: any) => void;\n  autoFocus: boolean;\n}\n\nconst RadioGroupContext = React.createContext<RadioGroupCtx<any>>({} as any);\n\nexport interface RadioProps<V> {\n  value: V;\n  children: any;\n  onFocus?: (e: React.FocusEvent<any>) => void;\n  onBlur?: (e: any) => void;\n}\n\nexport interface RadioGroupProps<V> {\n  labelledBy: string;\n  children: React.ComponentType<RadioProps<V>>[];\n  value: V;\n  onChange: (value: V) => void;\n  autoFocus?: boolean;\n}\n\nexport function RadioGroup<V>({\n  labelledBy,\n  children,\n  value,\n  autoFocus = false,\n  ...props\n}: RadioGroupProps<V>) {\n  const setChecked = React.useCallback(v => {\n    if (props.onChange) {\n      props.onChange(v);\n    }\n  }, []);\n\n  const otherRadioValues = React.Children.map<any, any>(\n    children,\n    child => child.props.value\n  );\n  const ctx = React.useMemo(\n    () => ({\n      value,\n      otherRadioValues,\n      setChecked,\n      autoFocus,\n    }),\n    [otherRadioValues, value]\n  );\n  return (\n    <RadioGroupContext.Provider value={ctx}>\n      <div\n        role=\"radiogroup\"\n        aria-labelledby={labelledBy}\n        data-palmerhq-radio-group\n      >\n        {children}\n      </div>\n    </RadioGroupContext.Provider>\n  );\n}\n\nexport const Radio = React.forwardRef<HTMLDivElement | null, RadioProps<any>>(\n  ({ children, ...props }, maybeOuterRef: any) => {\n    const [focus, setFocus] = React.useState(false);\n    const ref = React.useRef<HTMLDivElement | null>(null);\n\n    const ctx = React.useContext(RadioGroupContext);\n    const { otherRadioValues, value, setChecked, autoFocus } = ctx;\n    const index = otherRadioValues.findIndex(i => i == props.value);\n    const count = otherRadioValues.length - 1;\n    React.useEffect(() => {\n      if (autoFocus && value === props.value) {\n        if (maybeOuterRef && maybeOuterRef.current !== null) {\n          maybeOuterRef.current.focus();\n        } else if (ref.current !== null) {\n          ref.current.focus();\n        }\n      }\n    }, [value, props.value, maybeOuterRef, autoFocus]);\n\n    const handleKeyDown = React.useCallback(\n      event => {\n        event.persist();\n        var flag = false;\n        function setPrevious() {\n          if (index === 0) {\n            setChecked(otherRadioValues[count]);\n          } else {\n            setChecked(otherRadioValues[index - 1]);\n          }\n        }\n\n        function setNext() {\n          if (index === count) {\n            setChecked(otherRadioValues[0]);\n          } else {\n            setChecked(otherRadioValues[index + 1]);\n          }\n        }\n\n        switch (event.keyCode) {\n          case codes.SPACE:\n          case codes.RETURN:\n            setChecked(props.value);\n            flag = true;\n            break;\n          case codes.UP:\n          case codes.LEFT:\n            setPrevious();\n            flag = true;\n            break;\n          case codes.DOWN:\n          case codes.RIGHT:\n            setNext();\n            flag = true;\n            break;\n          default:\n            break;\n        }\n\n        if (flag) {\n          event.stopPropagation();\n          event.preventDefault();\n        }\n      },\n      [children, otherRadioValues, props.value, count, index]\n    );\n\n    const handleClick = React.useCallback(() => {\n      setChecked(props.value);\n    }, [props.value]);\n\n    const handleBlur = React.useCallback(e => {\n      if (props.onBlur) {\n        props.onBlur(e);\n      }\n      setFocus(false);\n    }, []);\n\n    const handleFocus = React.useCallback(e => {\n      if (props.onFocus) {\n        props.onFocus(e);\n      }\n      setFocus(true);\n    }, []);\n    return (\n      <div\n        {...props}\n        role=\"radio\"\n        tabIndex={value === props.value ? 0 : -1}\n        aria-checked={value === props.value}\n        onBlur={handleBlur}\n        onFocus={handleFocus}\n        onClick={handleClick}\n        onKeyDown={handleKeyDown}\n        data-palmerhq-radio\n        data-palmerhq-radio-focus={focus}\n        ref={el => {\n          if (maybeOuterRef) {\n            maybeOuterRef.current = el;\n          }\n          ref.current = el;\n        }}\n        children={children}\n      />\n    );\n  }\n);\n"],"names":["RadioGroupContext","React","Radio","ref$1","maybeOuterRef","ref","ctx","index","otherRadioValues","findIndex","i","props","value","count","length","autoFocus","current","focus","handleKeyDown","event","persist","flag","keyCode","setChecked","stopPropagation","preventDefault","children","handleClick","handleBlur","e","onBlur","setFocus","handleFocus","onFocus","role","tabIndex","onClick","onKeyDown","el","v","onChange","map","child","Provider","labelledBy"],"mappings":"kJAAA,IAoBMA,EAAoBC,gBAAwC,IAwDrDC,EAAQD,sBAClBE,EAAwBC,0CACGH,YAAe,iBACnCI,EAAMJ,SAAoC,MAE1CK,EAAML,aAAiBD,+DAEvBO,EAAQC,EAAiBC,mBAAUC,UAAKA,GAAKC,EAAMC,QACnDC,EAAQL,EAAiBM,OAAS,EACxCb,uBACMc,GAAaH,IAAUD,EAAMC,QAC3BR,GAA2C,OAA1BA,EAAcY,QACjCZ,EAAcY,QAAQC,QACG,OAAhBZ,EAAIW,SACbX,EAAIW,QAAQC,UAGf,CAACL,EAAOD,EAAMC,MAAOR,EAAeW,QAEjCG,EAAgBjB,uBACpBkB,GACEA,EAAMC,cACFC,GAAO,SAiBHF,EAAMG,cA/Gb,QADC,GAmHEC,EAAWZ,EAAMC,OACjBS,GAAO,aA/Gb,QADE,GA8FIE,EADY,IAAVhB,EACSC,EAAiBK,GAEjBL,EAAiBD,EAAQ,IAqBpCc,GAAO,aAlHX,QADC,GAoGGE,EADEhB,IAAUM,EACDL,EAAiB,GAEjBA,EAAiBD,EAAQ,IAkBpCc,GAAO,EAMPA,IACFF,EAAMK,kBACNL,EAAMM,mBAGV,CAACC,EAAUlB,EAAkBG,EAAMC,MAAOC,EAAON,IAG7CoB,EAAc1B,yBAClBsB,EAAWZ,EAAMC,QAChB,CAACD,EAAMC,QAEJgB,EAAa3B,uBAAkB4B,GAC/BlB,EAAMmB,QACRnB,EAAMmB,OAAOD,GAEfE,GAAS,IACR,IAEGC,EAAc/B,uBAAkB4B,GAChClB,EAAMsB,SACRtB,EAAMsB,QAAQJ,GAEhBE,GAAS,IACR,WAED9B,uCACMU,GACJuB,KAAK,QACLC,SAAUvB,IAAUD,EAAMC,MAAQ,GAAK,iBACzBA,IAAUD,EAAMC,MAC9BkB,OAAQF,EACRK,QAASD,EACTI,QAAST,EACTU,UAAWnB,uDAEgBD,EAC3BZ,aAAKiC,GACClC,IACFA,EAAcY,QAAUsB,GAE1BjC,EAAIW,QAAUsB,GAEhBZ,SAAUA,mCA7IYrB,2EAIhB,4DAGNkB,EAAatB,uBAAkBsC,GAC/B5B,EAAM6B,UACR7B,EAAM6B,SAASD,IAEhB,IAEG/B,EAAmBP,WAAewC,IACtCf,WACAgB,UAASA,EAAM/B,MAAMC,QAEjBN,EAAML,kCAERW,mBACAJ,aACAe,YACAR,IAEF,CAACP,EAAkBI,WAGnBX,gBAACD,EAAkB2C,UAAS/B,MAAON,GACjCL,uBACEiC,KAAK,+BACYU,kCAGhBlB"}