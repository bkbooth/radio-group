{"version":3,"file":"radio-group.esm.js","sources":["../src/index.tsx"],"sourcesContent":["import * as React from 'react';\n\nconst codes = {\n  RETURN: 13,\n  SPACE: 32,\n  END: 35,\n  HOME: 36,\n  LEFT: 37,\n  UP: 38,\n  RIGHT: 39,\n  DOWN: 40,\n};\n\nexport interface RadioGroupCtx<V, Siblings = V[]> {\n  value: V;\n  otherRadioValues: Siblings;\n  setChecked: (value: any) => void;\n  autoFocus: boolean;\n}\n\nconst RadioGroupContext = React.createContext<RadioGroupCtx<any>>({} as any);\n\nexport interface RadioProps<V> {\n  value: V;\n  children: any;\n  onFocus?: (e: React.FocusEvent<any>) => void;\n  onBlur?: (e: any) => void;\n}\n\nexport interface RadioGroupProps<V> {\n  labelledBy: string;\n  children: React.ComponentType<RadioProps<V>>[];\n  value: V;\n  onChange: (value: V) => void;\n  autoFocus?: boolean;\n}\n\nexport function RadioGroup<V>({\n  labelledBy,\n  children,\n  value,\n  autoFocus = false,\n  ...props\n}: RadioGroupProps<V>) {\n  const setChecked = React.useCallback(v => {\n    if (props.onChange) {\n      props.onChange(v);\n    }\n  }, []);\n\n  const otherRadioValues = React.Children.map<any, any>(\n    children,\n    child => child.props.value\n  );\n  const ctx = React.useMemo(\n    () => ({\n      value,\n      otherRadioValues,\n      setChecked,\n      autoFocus,\n    }),\n    [otherRadioValues, value]\n  );\n  return (\n    <RadioGroupContext.Provider value={ctx}>\n      <div\n        role=\"radiogroup\"\n        aria-labelledby={labelledBy}\n        data-palmerhq-radio-group\n      >\n        {children}\n      </div>\n    </RadioGroupContext.Provider>\n  );\n}\n\nexport const Radio = React.forwardRef<HTMLDivElement | null, RadioProps<any>>(\n  ({ children, ...props }, maybeOuterRef: any) => {\n    const [focus, setFocus] = React.useState(false);\n    const ref = React.useRef<HTMLDivElement | null>(null);\n\n    const ctx = React.useContext(RadioGroupContext);\n    const { otherRadioValues, value, setChecked, autoFocus } = ctx;\n    const index = otherRadioValues.findIndex(i => i == props.value);\n    const count = otherRadioValues.length - 1;\n    React.useEffect(() => {\n      if (autoFocus && value === props.value) {\n        if (maybeOuterRef && maybeOuterRef.current !== null) {\n          maybeOuterRef.current.focus();\n        } else if (ref.current !== null) {\n          ref.current.focus();\n        }\n      }\n    }, [value, props.value, maybeOuterRef, autoFocus]);\n\n    const handleKeyDown = React.useCallback(\n      event => {\n        event.persist();\n        var flag = false;\n        function setPrevious() {\n          if (index === 0) {\n            setChecked(otherRadioValues[count]);\n          } else {\n            setChecked(otherRadioValues[index - 1]);\n          }\n        }\n\n        function setNext() {\n          if (index === count) {\n            setChecked(otherRadioValues[0]);\n          } else {\n            setChecked(otherRadioValues[index + 1]);\n          }\n        }\n\n        switch (event.keyCode) {\n          case codes.SPACE:\n          case codes.RETURN:\n            setChecked(props.value);\n            flag = true;\n            break;\n          case codes.UP:\n          case codes.LEFT:\n            setPrevious();\n            flag = true;\n            break;\n          case codes.DOWN:\n          case codes.RIGHT:\n            setNext();\n            flag = true;\n            break;\n          default:\n            break;\n        }\n\n        if (flag) {\n          event.stopPropagation();\n          event.preventDefault();\n        }\n      },\n      [children, otherRadioValues, props.value, count, index]\n    );\n\n    const handleClick = React.useCallback(() => {\n      setChecked(props.value);\n    }, [props.value]);\n\n    const handleBlur = React.useCallback(e => {\n      if (props.onBlur) {\n        props.onBlur(e);\n      }\n      setFocus(false);\n    }, []);\n\n    const handleFocus = React.useCallback(e => {\n      if (props.onFocus) {\n        props.onFocus(e);\n      }\n      setFocus(true);\n    }, []);\n    return (\n      <div\n        {...props}\n        role=\"radio\"\n        tabIndex={value === props.value ? 0 : -1}\n        aria-checked={value === props.value}\n        onBlur={handleBlur}\n        onFocus={handleFocus}\n        onClick={handleClick}\n        onKeyDown={handleKeyDown}\n        data-palmerhq-radio\n        data-palmerhq-radio-focus={focus}\n        ref={el => {\n          if (maybeOuterRef) {\n            maybeOuterRef.current = el;\n          }\n          ref.current = el;\n        }}\n        children={children}\n      />\n    );\n  }\n);\n"],"names":["RadioGroupContext","React","RadioGroup","ref","setChecked","v","props","onChange","otherRadioValues","map","children","child","value","ctx","autoFocus","Provider","role","labelledBy","Radio","ref$1","maybeOuterRef","index","findIndex","i","count","length","current","focus","handleKeyDown","event","persist","flag","keyCode","stopPropagation","preventDefault","handleClick","handleBlur","e","onBlur","setFocus","handleFocus","onFocus","tabIndex","onClick","onKeyDown","el"],"mappings":"ySAAA,IAoBMA,EAAoBC,EAAwC,aAiBlDC,EAAcC,2EAIhB,4DAGNC,EAAaH,WAAkBI,GAC/BC,EAAMC,UACRD,EAAMC,SAASF,IAEhB,IAEGG,EAAmBP,EAAeQ,IACtCC,WACAC,UAASA,EAAML,MAAMM,QAEjBC,EAAMZ,0BAERW,mBACAJ,aACAJ,YACAU,IAEF,CAACN,EAAkBI,WAGnBX,EAACD,EAAkBe,UAASH,MAAOC,GACjCZ,SACEe,KAAK,+BACYC,kCAGhBP,IAMT,IAAaQ,EAAQjB,WAClBkB,EAAwBC,0CACGnB,GAAe,iBACnCE,EAAMF,EAAoC,MAE1CY,EAAMZ,EAAiBD,+DAEvBqB,EAAQb,EAAiBc,mBAAUC,UAAKA,GAAKjB,EAAMM,QACnDY,EAAQhB,EAAiBiB,OAAS,EACxCxB,aACMa,GAAaF,IAAUN,EAAMM,QAC3BQ,GAA2C,OAA1BA,EAAcM,QACjCN,EAAcM,QAAQC,QACG,OAAhBxB,EAAIuB,SACbvB,EAAIuB,QAAQC,UAGf,CAACf,EAAON,EAAMM,MAAOQ,EAAeN,QAEjCc,EAAgB3B,WACpB4B,GACEA,EAAMC,cACFC,GAAO,SAiBHF,EAAMG,cA/Gb,QADC,GAmHE5B,EAAWE,EAAMM,OACjBmB,GAAO,aA/Gb,QADE,GA8FI3B,EADY,IAAViB,EACSb,EAAiBgB,GAEjBhB,EAAiBa,EAAQ,IAqBpCU,GAAO,aAlHX,QADC,GAoGG3B,EADEiB,IAAUG,EACDhB,EAAiB,GAEjBA,EAAiBa,EAAQ,IAkBpCU,GAAO,EAMPA,IACFF,EAAMI,kBACNJ,EAAMK,mBAGV,CAACxB,EAAUF,EAAkBF,EAAMM,MAAOY,EAAOH,IAG7Cc,EAAclC,aAClBG,EAAWE,EAAMM,QAChB,CAACN,EAAMM,QAEJwB,EAAanC,WAAkBoC,GAC/B/B,EAAMgC,QACRhC,EAAMgC,OAAOD,GAEfE,GAAS,IACR,IAEGC,EAAcvC,WAAkBoC,GAChC/B,EAAMmC,SACRnC,EAAMmC,QAAQJ,GAEhBE,GAAS,IACR,WAEDtC,yBACMK,GACJU,KAAK,QACL0B,SAAU9B,IAAUN,EAAMM,MAAQ,GAAK,iBACzBA,IAAUN,EAAMM,MAC9B0B,OAAQF,EACRK,QAASD,EACTG,QAASR,EACTS,UAAWhB,uDAEgBD,EAC3BxB,aAAK0C,GACCzB,IACFA,EAAcM,QAAUmB,GAE1B1C,EAAIuB,QAAUmB,GAEhBnC,SAAUA"}